# 架构安全性
即使只限定在“软件架构设计”这个语境下，系统安全仍然是一个很大的话题。我们谈论的计算机系统安全，不仅仅是指“防御系统被黑客攻击”这样狭隘的安全,，还至少应包括（不限于）以下这些问题的具体解决方案：

+ 认证（Authentication）：系统如何正确分辨出操作用户的真实身份？
+ 授权（ Authorization）：系统如何控制一个用户该看到哪些数据、能操作哪些功能？
+ 凭证（Credential）：系统如何保证它与用户之间的承诺是双方当时真实意图的体现，是准确、完整且不可抵赖的？
+ 保密（Confidentiality）：系统如何保证敏感数据无法被包括系统管理员在内的内外部人员所窃取、滥用？
+ 传输（Transport Security）：系统如何保证通过网络传输的信息无法被第三方窃听、篡改和冒充？
+ 验证（Verification）：系统如何确保提交到每项服务中的数据是合乎规则的，不会对系统稳定性、数据一致性、正确性产生风险？

## 认证

认证、授权和凭证可以说是一个系统中最基础的安全设计，哪怕再简陋的信息系统，大概也不可能忽略掉“用户登录”功能。信息系统为用户提供服务之前，总是希望先弄清楚“你是谁？”（认证）、“你能干什么？”（授权）以及“你如何证明？”（凭证）这三个基本问题。

具体含义和应用场景列举如下。

+ 通信信道上的认证：你和我建立通信连接之前，要先证明你是谁。在网络传输（Network）场景中的典型是基于 SSL/TLS 传输安全层的认证。
+ 通信协议上的认证：你请求获取我的资源之前，要先证明你是谁。在互联网（Internet）场景中的典型是基于 HTTP 协议的认证。
+ 通信内容上的认证：你使用我提供的服务之前，要先证明你是谁。在万维网（World Wide Web）场景中的典型是基于 Web 内容的认证。

## 授权 : 一个用户能看到那些数据，可以操作那些功能
日常开发中最常用到的 RBAC 和 OAuth2 这两种访问控制和授权方案

RBAC是  用户属于角色，角色拥有权限，权限操作资源，把对于资源的水平权限，改成垂直权限。

OAuth2是面向于解决第三方应用的认证授权协议


## 凭证
系统如何保证它与用户之间的承诺是双方当时真实意图的体现，是准确、完整且不可抵赖的？

软件架构对于共享状态信息有两种不同思路，状态应该维护在服务端，还是在客户端中。以HTTP协议的Cookie和Session机制为代表的服务端状态存储是在三十年来都是主流的解决方案。
而分布式系统共享数据必然会收到CAP原理的打击，迫使人民去审视之前已经放弃的客户端状态存储。也就是JWT令牌方案。

JWT只解决防篡改问题，并不解决防泄露问题。
JWT有三部分，令牌头，负载，签名。（签名是保证没有被篡改的标准-对称加密和非对称加密）

## 保密
保密是加密和解密的统称，是一种概念。和传输过程中摘要，加密，签名
1. 以摘要替代明文 （做一次哈希）
2. 先加盐值再做哈希是应对弱密码的常见方法
3. 将盐值变为动态值能有效防止冒认: （协商盐值的过程极为复杂,同时协商只保护一次操作，也难以阻止其他服务的重放攻击）
4. 给服务加入令牌,在网关或其他流量公共位置建立校验逻辑，服务端愿意付出在集群中分发令牌信息等代价的前提下，可以做到防止重放攻击。但是还是会在传输过程中被嗅探而泄露
5. 启用https，在通信层面解决重放问题。客户端被攻破产生伪造根证书的风险，服务端被攻破导致的证书泄露而被中间人冒领的风险
6. 使用独立于客户端的物理设备（U盘）或者信息通道（手机验证码，电子邮件） 搭建与公网隔离的专用网络来保障通信安全

## 传输

摘要 ： 对一份数据，进行单向的Hash函数，生成固定长度的hash值，这个值就是这份数据的摘要，也称为指纹。
加密 ： 加密算法（对称和非对称），
签名 ： 基于大整数的因数分解可以生成一对公钥(PublicKey)和私钥(PrivateKey)，
        如果用「公钥」对数据加密，用「私钥」去解密，这是「加密」；
        反之用「私钥」对数据加密，用「公钥」去解密，这是「签名」。由于所有的人都持有公钥，所以签名并不能保证数据的安全性。但签名却可以保证消息的准确性和不可否认性。

目前高效的签名方案 ：
        将摘要算法和非对称加密结合使用。
        如何签名：先用摘要算法计算明文数据的摘要值，再对这个摘要值用私钥加密。这样就能较快速地得到了原始信息的签名；
        如何验证：先用相同的摘要算法计算原始信息的摘要值，再用公钥对签名解密，得到收到的摘要值，最后对比这两个摘要值判断是否相等。如果不相等说明数据不可信。

数字证书 ： 那么公钥是否是正确的，谁能证明，那就是需要一个中间人（CA）去做。

>ps ： 
   为什么公钥和私钥的是安全的？ 为什么公钥加密，公钥却接不了密码
   安全 ？？？ 什么算法单向计算容易，逆向反推非常难呢==模运算  配合 质数分解 可以做到安全。 
>  公钥不能解密 ？？？ 因为欧拉定理






